<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>#1 Time To Shine Cleaning Co in Ontario, CA 91762 | Trusted Local Experts</title>
  <meta name="description" content="Looking for the best Time To Shine Cleaning Co in Ontario, CA 91762? Professional services available now. Verified business in 91762. Near local landmarks.">
  <link rel="canonical" href="https://truewebx.site/profile/time-to-shine-cleaning-co-ontario-ca/">
  <link rel="icon" type="image/png" href="https://vrpyomevjlsacourdmki.supabase.co/storage/v1/object/public/profiles/profile_8f348569-ef68-44f3-869e-c3e8e5267ddd.jpeg">
  <link rel="apple-touch-icon" href="https://vrpyomevjlsacourdmki.supabase.co/storage/v1/object/public/profiles/profile_8f348569-ef68-44f3-869e-c3e8e5267ddd.jpeg">
  <meta property="og:type" content="business.business">
  <meta property="og:title" content="#1 Time To Shine Cleaning Co in Ontario, CA 91762 | Trusted Local Experts">
  <meta property="og:description" content="Looking for the best Time To Shine Cleaning Co in Ontario, CA 91762? Professional services available now. Verified business in 91762. Near local landmarks.">
  <meta property="og:image" content="https://vrpyomevjlsacourdmki.supabase.co/storage/v1/object/public/profiles/profile_8f348569-ef68-44f3-869e-c3e8e5267ddd.jpeg">
  <meta property="og:url" content="https://truewebx.site/profile/time-to-shine-cleaning-co-ontario-ca/">
  <meta property="og:site_name" content="TrueWebX">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    :root { --coral: #ff6b6b; --turquoise: #0d9488; --text: #ffffff; --glass: rgba(255, 255, 255, 0.15); --bg-gradient: linear-gradient(135deg, var(--turquoise), var(--coral)); }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg-gradient); background-attachment: fixed; color: var(--text); min-height: 100vh; overflow-x: hidden; }
    
    /* Next-Gen Glassmorphism 2.0 Messaging */
    #msgModal { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(25px) saturate(200%); -webkit-backdrop-filter: blur(25px) saturate(200%); }
    .chat-container { background: rgba(20, 20, 30, 0.75); border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: 0 30px 60px rgba(0,0,0,0.6); border-radius: 40px; }
    .chat-header { background: linear-gradient(90deg, rgba(255, 255, 255, 0.05), transparent); padding: 25px; border-bottom: 1px solid rgba(255,255,255,0.08); }
    .bubble { 
        padding: 14px 20px; 
        border-radius: 24px; 
        max-width: 85%; 
        position: relative; 
        font-size: 1rem; 
        line-height: 1.5; 
        animation: bubblePop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        cursor: pointer;
        transition: transform 0.2s;
    }
    .bubble:active { transform: scale(0.96); }
    .bubble.owner { align-self: flex-start; background: rgba(255, 255, 255, 0.08); border-radius: 20px 20px 20px 4px; border: 1px solid rgba(255,255,255,0.05); }
    .bubble.client { align-self: flex-end; background: linear-gradient(135deg, var(--coral), #ff4d4d); color: white; border-radius: 20px 20px 4px 20px; box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3); }
    .bubble.deleted { opacity: 0.5; font-style: italic; background: rgba(0,0,0,0.2) !important; border: 1px dashed rgba(255,255,255,0.2) !important; }
    
    .reaction-bar { display: none; position: absolute; top: -50px; left: 50%; transform: translateX(-50%); background: rgba(30, 30, 45, 0.95); backdrop-filter: blur(15px); border-radius: 30px; padding: 5px 15px; gap: 10px; border: 1px solid rgba(255,255,255,0.2); z-index: 100; box-shadow: 0 10px 25px rgba(0,0,0,0.4); animation: barSlideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .reaction-bar span { font-size: 24px; cursor: pointer; transition: transform 0.2s; }
    .reaction-bar span:hover { transform: scale(1.4); }
    
    .reactions-display { position: absolute; bottom: -12px; right: 10px; display: flex; gap: 4px; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); padding: 2px 6px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); font-size: 12px; }

    @keyframes bubblePop { from { transform: scale(0.8) translateY(20px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }
    @keyframes barSlideUp { from { transform: translateX(-50%) translateY(10px); opacity: 0; } to { transform: translateX(-50%) translateY(0); opacity: 1; } }

    /* Custom Scrollbar */
    #chatHistory::-webkit-scrollbar { width: 6px; }
    #chatHistory::-webkit-scrollbar-track { background: transparent; }
    #chatHistory::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
    #chatHistory::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }
  </style>
  <script type="application/ld+json">
  [
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "TrueWebX", "item": "https://truewebx.site/" },
        { "@type": "ListItem", "position": 2, "name": "Profiles", "item": "https://truewebx.site/profile/" },
        { "@type": "ListItem", "position": 3, "name": "Time To Shine Cleaning Co", "item": "https://truewebx.site/profile/time-to-shine-cleaning-co-ontario-ca/" }
      ]
    },
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "Time To Shine Cleaning Co",
      "image": "https://vrpyomevjlsacourdmki.supabase.co/storage/v1/object/public/profiles/profile_8f348569-ef68-44f3-869e-c3e8e5267ddd.jpeg",
      "url": "https://truewebx.site/profile/time-to-shine-cleaning-co-ontario-ca/",
      "telephone": "6573194617",
      "email": "jcarrillo@timetoshinecleaningco.com",
      "priceRange": "",
      "openingHours": "Mo-Su 08:00-18:00",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Ontario",
        "postalCode": "91762",
        "addressCountry": "US"
      },
      "description": "Commercial cleaning service specializing in deep cleans, move-in /move-out cleans and recurring monthly services"
    }
  ]
  </script>
</head>
<body>
  <header class="header-wrapper" id="header">
    <a href="https://truewebx.site/" class="logo-link" aria-label="TrueWebX Home">
        <img src="https://truewebx.site/favicon/TrueWebX.jpeg" alt="TrueWebX Logo" width="240" height="64" loading="eager">
    </a>
    <a href="https://truewebx.site/dashboard.html" class="login-btn" aria-label="Login or Sign Up">
        <i class="fas fa-user-circle" aria-hidden="true"></i> Login / Sign Up
    </a>
  </header>

  <div class="container">
    <img src="https://vrpyomevjlsacourdmki.supabase.co/storage/v1/object/public/profiles/profile_8f348569-ef68-44f3-869e-c3e8e5267ddd.jpeg" alt="Time To Shine Cleaning Co profile" class="profile-img">
    <h1>Time To Shine Cleaning Co</h1>
    <div class="location"><i class="fas fa-map-marker-alt"></i> <address style="display:inline; font-style:normal;">Ontario, CA 91762</address></div>
    <div class="description">Commercial cleaning service specializing in deep cleans, move-in /move-out cleans and recurring monthly services</div>
    <div class="contact-info">
      <p><i class="fas fa-phone"></i> <a href="tel:6573194617">6573194617</a></p>
      <p><i class="fas fa-envelope"></i> <a href="mailto:jcarrillo@timetoshinecleaningco.com">Send Email</a></p>
      <p><i class="fas fa-comment-dots"></i> <a href="javascript:void(0)" onclick="openContactChat('43564c84-f1de-4aee-b927-8ebb5ba63644')">Message Owner</a></p>
    </div>
    
    
    <div style="margin:60px 0;">
      <button class="cta-button" onclick="openContactChat('43564c84-f1de-4aee-b927-8ebb5ba63644')"><i class="fas fa-comments"></i> Message Owner</button>
      <button class="cta-button" onclick="const btn=this; const originalText=btn.innerText; navigator.clipboard.writeText(window.location.href); btn.innerText='\u2713 Copied!'; btn.style.background='#0d9488'; setTimeout(()=>{btn.innerText=originalText; btn.style.background='';}, 2500)">Share Profile</button>
    </div>

    <!-- Next-Gen Messaging Modal -->
    <div id="msgModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:9999; justify-content:center; align-items:center; padding:15px;">
        <div class="chat-container" style="width:100%; max-width:480px; height: 85vh; display:flex; flex-direction:column; position:relative; overflow:hidden;">
            <div class="chat-header">
                <button onclick="window.closeModal()" style="position:absolute; top:20px; right:25px; background:rgba(255,255,255,0.1); border:none; width:40px; height:40px; border-radius:50%; color:white; font-size:24px; cursor:pointer; display:grid; place-items:center; transition:0.3s;">&times;</button>
                <div style="display:flex; align-items:center; gap:15px;">
                    <div style="width:50px; height:50px; background:var(--bg-gradient); border-radius:50%; display:grid; place-items:center; font-size:24px;"><i class="fas fa-robot"></i></div>
                    <div>
                        <h2 style="font-size:1.3rem; margin:0;">Time To Shine Cleaning Co</h2>
                        <div style="display:flex; align-items:center; gap:5px; font-size:0.8rem; opacity:0.6;">
                            <div style="width:8px; height:8px; background:#4ade80; border-radius:50%;"></div> Online
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="chatHistory" style="flex:1; overflow-y:auto; padding:25px; display:flex; flex-direction:column; gap:15px; background: transparent;">
                <p style="text-align:center; opacity:0.6; margin:auto;">Powering up the chat...</p>
            </div>

            <!-- Reaction Bar (Hidden by default) -->
            <div id="reactionBar" class="reaction-bar">
                <span onclick="reactToMessage('â¤ï¸')">â¤ï¸</span>
                <span onclick="reactToMessage('ðŸ˜‚')">ðŸ˜‚</span>
                <span onclick="reactToMessage('ðŸ‘')">ðŸ‘</span>
                <span onclick="reactToMessage('ðŸ”¥')">ðŸ”¥</span>
                <span onclick="reactToMessage('ðŸ˜®')">ðŸ˜®</span>
                <button onclick="toggleDeleteMenu()" style="background:rgba(255,0,0,0.2); border:none; color:white; padding:5px 10px; border-radius:15px; cursor:pointer; font-size:12px; margin-left:10px;">Delete</button>
            </div>

            <!-- Delete Menu (Hidden) -->
            <div id="deleteMenu" style="display:none; position:absolute; bottom:120px; left:50%; transform:translateX(-50%); background:rgba(30,30,40,0.95); backdrop-filter:blur(20px); border-radius:24px; padding:20px; border:1px solid rgba(255,0,0,0.3); z-index:101; text-align:center; box-shadow:0 15px 40px rgba(0,0,0,0.5);">
                <p style="margin-bottom:15px; font-weight:600;">Delete Message?</p>
                <div style="display:flex; gap:10px;">
                    <button onclick="deleteMessage('me')" style="background:rgba(255,255,255,0.1); border:none; color:white; padding:10px 15px; border-radius:12px; cursor:pointer;">For Me</button>
                    <button onclick="deleteMessage('everyone')" style="background:var(--coral); border:none; color:white; padding:10px 15px; border-radius:12px; cursor:pointer; font-weight:bold;">For Everyone</button>
                </div>
            </div>

            <div style="padding:25px; background:rgba(255,255,255,0.03); border-top:1px solid rgba(255,255,255,0.08);">
                <form id="contactForm" onsubmit="event.preventDefault(); sendMessage('43564c84-f1de-4aee-b927-8ebb5ba63644');" style="position:relative;">
                    <div id="guestFields" style="display:none; margin-bottom:15px; animation: bubblePop 0.3s ease;">
                        <input type="text" id="custName" placeholder="Your Name" required style="width:100%; padding:14px 20px; margin-bottom:10px; border-radius:18px; border:1px solid rgba(255,255,255,0.1); background:rgba(0,0,0,0.2); color:white; outline:none; transition:0.3s;" onfocus="this.style.borderColor='var(--coral)'">
                        <input type="text" id="custContact" placeholder="Email or Phone" required style="width:100%; padding:14px 20px; border-radius:18px; border:1px solid rgba(255,255,255,0.1); background:rgba(0,0,0,0.2); color:white; outline:none; transition:0.3s;" onfocus="this.style.borderColor='var(--coral)'">
                    </div>
                    
                    <div style="display:flex; gap:12px; align-items:flex-end; background:rgba(0,0,0,0.3); padding:8px; border-radius:28px; border:1px solid rgba(255,255,255,0.1);">
                        <button type="button" onclick="toggleEmojiPicker()" style="background:none; border:none; color:#ffeb3b; font-size:22px; padding:10px; cursor:pointer; transition:0.3s;" class="hover-scale"><i class="far fa-smile"></i></button>
                        <textarea id="custMsg" placeholder="Type message..." required style="flex:1; padding:12px; border:none; background:transparent; color:white; min-height:45px; height:45px; outline:none; resize:none; font-size:1rem;"></textarea>
                        <button type="submit" id="sendBtn" style="width:45px; height:45px; border-radius:50%; border:none; background:var(--coral); color:white; cursor:pointer; transition:0.3s; display:grid; place-items:center; box-shadow:0 4px 15px rgba(255,107,107,0.4);"><i class="fas fa-paper-plane"></i></button>
                    </div>

                    <!-- Emoji Picker Quick Bar -->
                    <div id="emojiPicker" style="display:none; position:absolute; bottom:75px; left:0; width:100%; background:rgba(30,30,45,0.98); backdrop-filter:blur(20px); border-radius:24px; padding:15px; border:1px solid rgba(255,255,255,0.1); z-index:102; box-shadow:0 15px 40px rgba(0,0,0,0.6);">
                        <div style="display:grid; grid-template-columns: repeat(8, 1fr); gap:10px; text-align:center;">
                            <span onclick="addEmoji('ðŸ˜Š')" style="cursor:pointer; font-size:24px;">ðŸ˜Š</span>
                            <span onclick="addEmoji('ðŸ˜‚')" style="cursor:pointer; font-size:24px;">ðŸ˜‚</span>
                            <span onclick="addEmoji('â¤ï¸')" style="cursor:pointer; font-size:24px;">â¤ï¸</span>
                            <span onclick="addEmoji('ðŸ‘')" style="cursor:pointer; font-size:24px;">ðŸ‘</span>
                            <span onclick="addEmoji('ðŸ”¥')" style="cursor:pointer; font-size:24px;">ðŸ”¥</span>
                            <span onclick="addEmoji('ðŸ™Œ')" style="cursor:pointer; font-size:24px;">ðŸ™Œ</span>
                            <span onclick="addEmoji('âœ¨')" style="cursor:pointer; font-size:24px;">âœ¨</span>
                            <span onclick="addEmoji('âœ…')" style="cursor:pointer; font-size:24px;">âœ…</span>
                            <span onclick="addEmoji('ðŸ‘‹')" style="cursor:pointer; font-size:24px;">ðŸ‘‹</span>
                            <span onclick="addEmoji('ðŸ™')" style="cursor:pointer; font-size:24px;">ðŸ™</span>
                            <span onclick="addEmoji('ðŸ˜Ž')" style="cursor:pointer; font-size:24px;">ðŸ˜Ž</span>
                            <span onclick="addEmoji('ðŸ’¯')" style="cursor:pointer; font-size:24px;">ðŸ’¯</span>
                            <span onclick="addEmoji('ðŸŽ‰')" style="cursor:pointer; font-size:24px;">ðŸŽ‰</span>
                            <span onclick="addEmoji('ðŸ¤©')" style="cursor:pointer; font-size:24px;">ðŸ¤©</span>
                            <span onclick="addEmoji('ðŸ’ª')" style="cursor:pointer; font-size:24px;">ðŸ’ª</span>
                            <span onclick="addEmoji('ðŸ“')" style="cursor:pointer; font-size:24px;">ðŸ“</span>
                        </div>
                    </div>
                </form>
                
                <div id="authPrompt" style="display:none; text-align:center; margin-top:20px; font-size:0.8rem; opacity:0.6;">
                    <p>Logging in saves your chat history across devices.</p>
                    <a href="https://truewebx.site/dashboard.html" style="color:var(--coral); text-decoration:none; font-weight:bold;">Sign In</a>
                </div>
            </div>
        </div>
    </div>
        <h2 style="font-size: 2.4rem; margin: 80px 0 40px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 40px;">Related Businesses in Your Area</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-bottom: 60px;">        <a href="https://truewebx.site/profile/fargo-fresh-maids-fargo-nd/" style="text-decoration: none; color: white;">
            <div style="background: rgba(255,255,255,0.08); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateY(-5px)'" onmouseout="this.style.background='rgba(255,255,255,0.08)'; this.style.transform='none'">
                <img src="https://vrpyomevjlsacourdmki.supabase.co/storage/v1/object/public/profiles/profile_376fe124-5183-4e6d-ac0a-3f8cd40d8cbb.jpeg" alt="Fargo Fresh Maids" style="width: 100%; height: 180px; object-fit: cover; border-radius: 12px; margin-bottom: 15px;">
                <h3 style="font-size: 1.4rem; margin-bottom: 10px;">Fargo Fresh Maids</h3>
                <p style="opacity: 0.8; font-size: 0.95rem;"><i class="fas fa-map-marker-alt" style="color: var(--coral); margin-right: 5px;"></i> Fargo</p>
            </div>
        </a>        <a href="https://truewebx.site/profile/zoiris-cleaning-services-mobile/" style="text-decoration: none; color: white;">
            <div style="background: rgba(255,255,255,0.08); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateY(-5px)'" onmouseout="this.style.background='rgba(255,255,255,0.08)'; this.style.transform='none'">
                <img src="https://vrpyomevjlsacourdmki.supabase.co/storage/v1/object/public/profiles/profile_a93b4c62-bed1-4b32-ab5e-6783233cb5ae.png" alt="Zoiris Cleaning Services" style="width: 100%; height: 180px; object-fit: cover; border-radius: 12px; margin-bottom: 15px;">
                <h3 style="font-size: 1.4rem; margin-bottom: 10px;">Zoiris Cleaning Services</h3>
                <p style="opacity: 0.8; font-size: 0.95rem;"><i class="fas fa-map-marker-alt" style="color: var(--coral); margin-right: 5px;"></i> Mobile</p>
            </div>
        </a>        <a href="https://truewebx.site/profile/pichy-barber-spanish-fort-al-mobile-al/" style="text-decoration: none; color: white;">
            <div style="background: rgba(255,255,255,0.08); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateY(-5px)'" onmouseout="this.style.background='rgba(255,255,255,0.08)'; this.style.transform='none'">
                <img src="https://vrpyomevjlsacourdmki.supabase.co/storage/v1/object/public/profiles/profile_2bfbb94c-707a-431e-81c0-e53187b1b3a4.jpeg" alt="Pichy Barber 💈🇨🇺 Spanish Fort AL" style="width: 100%; height: 180px; object-fit: cover; border-radius: 12px; margin-bottom: 15px;">
                <h3 style="font-size: 1.4rem; margin-bottom: 10px;">Pichy Barber 💈🇨🇺 Spanish Fort AL</h3>
                <p style="opacity: 0.8; font-size: 0.95rem;"><i class="fas fa-map-marker-alt" style="color: var(--coral); margin-right: 5px;"></i> Mobile</p>
            </div>
        </a></div>
    <a href="https://truewebx.site/" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Directory</a>
    <section class="seo-extra">
        <h2>Expert Service in Ontario</h2>
        <p>Providing top-rated solutions across the 91762 area. Local landmarks and neighborhoods are within our service reach.</p>
    </section>
    <footer>Powered by <strong>TrueWebX</strong> &bull; Trusted Global Business Directory</footer>
  </div>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const firebaseConfig = {
        apiKey: "AIzaSyBam-ZJXtbgHnhI7IeGLgKS-HeRdSBQNS0",
        authDomain: "limpieza-digital.firebaseapp.com",
        projectId: "limpieza-digital",
        storageBucket: "limpieza-digital.firebasestorage.app",
        messagingSenderId: "410437614466",
        appId: "1:410437614466:web:8abec9eb1189a2369bad9b"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const supabaseClient = supabase.createClient('https://vrpyomevjlsacourdmki.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZycHlvbWV2amxzYWNvdXJkbWtpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjE3MDg4NSwiZXhwIjoyMDgxNzQ2ODg1fQ.cPaMJJF6IqPV-KeT8_qux8dRXcyD7yFFds_ifRs3-yI');

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('custName').value = user.displayName || user.email.split('@')[0];
            document.getElementById('custContact').value = user.email;
            document.getElementById('authPrompt').style.display = 'none';
        } else {
            document.getElementById('authPrompt').style.display = 'block';
            // Only show guestFields if we don't have saved info
            const savedName = localStorage.getItem('TRUEWEBX_GUEST_NAME');
            const savedContact = localStorage.getItem('TRUEWEBX_GUEST_CONTACT');
            if (savedName && savedContact) {
                document.getElementById('custName').value = savedName;
                document.getElementById('custContact').value = savedContact;
                document.getElementById('guestFields').style.display = 'none';
            } else {
                document.getElementById('guestFields').style.display = 'block';
            }
        }
    });
    // Persistent Client ID for history without account
    if (!localStorage.getItem('TRUEWEBX_CLIENT_ID')) {
        localStorage.setItem('TRUEWEBX_CLIENT_ID', 'G-' + Math.random().toString(36).substring(2, 15));
    }
    const persistentClientId = localStorage.getItem('TRUEWEBX_CLIENT_ID');
      let activeMsgId = null; 
      let chatTimer = null;

      window.toggleEmojiPicker = () => {
        const p = document.getElementById('emojiPicker');
        p.style.display = p.style.display === 'none' ? 'block' : 'none';
      };

      window.addEmoji = (emoji) => {
        const input = document.getElementById('custMsg');
        input.value += emoji;
        window.toggleEmojiPicker();
        input.focus();
      };

      window.showReactions = (msgId, event) => {
        event.stopPropagation();
        activeMsgId = msgId;
        const bar = document.getElementById('reactionBar');
        bar.style.display = 'flex';
        // Position bar near the bubble
        const rect = event.currentTarget.getBoundingClientRect();
        bar.style.top = (rect.top - 60) + 'px';
        bar.style.left = (rect.left + rect.width/2) + 'px';
      };

      window.reactToMessage = async (emoji) => {
        if (!activeMsgId) return;
        const { data: msg } = await supabaseClient.from('messages').select('text').eq('id', activeMsgId).single();
        if (msg) {
            let newText = msg.text;
            if (newText.includes('!!REACTION:')) {
                newText = newText.split('!!REACTION:')[0] + '!!REACTION:' + emoji + '!!';
            } else {
                newText += ' !!REACTION:' + emoji + '!!';
            }
            await supabaseClient.from('messages').update({ text: newText }).eq('id', activeMsgId);
        }
        document.getElementById('reactionBar').style.display = 'none';
        loadChatHistory(window.currentBusinessId);
      };

      window.toggleDeleteMenu = () => {
          document.getElementById('deleteMenu').style.display = 'block';
      };

      window.deleteMessage = async (mode) => {
          if (!activeMsgId) return;
          if (mode === 'me') {
              const deleted = JSON.parse(localStorage.getItem('TRUEWEBX_DELETED_MSGS') || '[]');
              deleted.push(activeMsgId);
              localStorage.setItem('TRUEWEBX_DELETED_MSGS', JSON.stringify(deleted));
          } else {
              await supabaseClient.from('messages').update({ text: '!!DELETED!!' }).eq('id', activeMsgId);
          }
          document.getElementById('deleteMenu').style.display = 'none';
          document.getElementById('reactionBar').style.display = 'none';
          loadChatHistory(window.currentBusinessId);
      };

      async function loadChatHistory(serviceId) {
        window.currentBusinessId = serviceId;
        const user = auth.currentUser;
        const historyDiv = document.getElementById('chatHistory');
        if (!historyDiv) return;
        
        let filter = "text.ilike.%[GuestID: " + persistentClientId + "]%";
        if (user) filter += ",text.ilike.%[User: " + user.uid + "]%";

        const { data, error } = await supabaseClient.from('messages')
          .select('*')
          .eq('service_id', serviceId)
          .or(filter)
          .order('created_at', { ascending: true });

        if (error) return;

        const deletedLocal = JSON.parse(localStorage.getItem('TRUEWEBX_DELETED_MSGS') || '[]');
        const isScrolledToBottom = historyDiv.scrollHeight - historyDiv.clientHeight <= historyDiv.scrollTop + 1;

        historyDiv.innerHTML = data.length ? data.map(m => {
          if (deletedLocal.includes(m.id)) return '';
          
          let cleanText = m.text;
          let reaction = '';
          let isDeleted = false;

          if (cleanText.includes('!!DELETED!!')) {
              cleanText = 'Message unsent';
              isDeleted = true;
          } else {
              if (cleanText.includes('!!REACTION:')) {
                  reaction = cleanText.split('!!REACTION:')[1].split('!!')[0];
                  cleanText = cleanText.split('!!REACTION:')[0];
              }
              if (cleanText.includes('] - ')) {
                cleanText = cleanText.split('] - ').pop();
              }
              cleanText = cleanText.replace('[Owner]: ', '');
          }
          
          const reactionHtml = reaction ? '<div class="reactions-display">' + reaction + '</div>' : '';

          return '<div class="bubble ' + (m.is_from_owner ? 'owner' : 'client') + (isDeleted ? ' deleted' : '') + '" onclick="window.showReactions(' + m.id + ', event)">' +
              cleanText +
              reactionHtml +
              '<div style="font-size: 0.65rem; opacity: 0.5; margin-top: 6px; text-align: right;">' +
                new Date(m.created_at).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }) +
              '</div>' +
            '</div>';
        }).join('') : '<p style="text-align:center; opacity:0.4; margin:auto;">Start your fresh conversation âœ¨</p>';
        
        if (isScrolledToBottom) {
          historyDiv.scrollTop = historyDiv.scrollHeight;
        }
      }

      async function sendMessage(serviceId) {
        const btn = document.getElementById('sendBtn');
        const msgInput = document.getElementById('custMsg');
        const message = msgInput.value.trim();
        if (!message) return;

        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

        const user = auth.currentUser;
        const name = user ? (user.displayName || user.email.split('@')[0]) : document.getElementById('custName').value;
        const contact = user ? user.email : document.getElementById('custContact').value;

        const prefix = user ? "[User: " + user.uid + "]" : "[GuestID: " + persistentClientId + "]";
        const fullText = user ? prefix + " - " + message : prefix + " [Guest: " + name + " | Contact: " + contact + "] - " + message;

        const { error } = await supabaseClient.from('messages').insert([{
          service_id: serviceId,
          customer_id: null,
          text: fullText,
          is_from_owner: false
        }]);

        if (error) {
          alert('Error sending: ' + error.message);
        } else {
          // Save guest info to localStorage if not logged in
          if (!user) {
              localStorage.setItem('TRUEWEBX_GUEST_NAME', name);
              localStorage.setItem('TRUEWEBX_GUEST_CONTACT', contact);
              document.getElementById('guestFields').style.display = 'none';
          }
          msgInput.value = '';
          loadChatHistory(serviceId);
        }
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-paper-plane"></i>';
      }

      window.closeModal = () => {
        document.getElementById('msgModal').style.display = 'none';
        if (chatTimer) clearInterval(chatTimer);
      };

      window.openContactChat = (id) => {
        document.getElementById('msgModal').style.display = 'flex';
        loadChatHistory(id);
        if (chatTimer) clearInterval(chatTimer);
        chatTimer = setInterval(() => loadChatHistory(id), 4000);
      };

      // Close menus on outside click
      window.addEventListener('click', (e) => {
        if (!e.target.closest('.bubble') && !e.target.closest('.reaction-bar') && !e.target.closest('#deleteMenu')) {
            document.getElementById('reactionBar').style.display = 'none';
            document.getElementById('deleteMenu').style.display = 'none';
        }
        if (!e.target.closest('#emojiPicker') && !e.target.closest('button[onclick="toggleEmojiPicker()"]')) {
            document.getElementById('emojiPicker').style.display = 'none';
        }
        if (e.target.id === 'msgModal') {
          window.closeModal();
        }
      });

    // Header scroll logic
    let ticking = false;
    function updateHeader() {
        const header = document.getElementById('header');
        header.classList.toggle('scrolled', window.scrollY > 50);
        ticking = false;
    }
    window.addEventListener('scroll', () => {
        if (!ticking) {
            requestAnimationFrame(updateHeader);
            ticking = true;
        }
    }, { passive: true });

    // Gallery Slider logic
    const slider = document.getElementById('gallerySlider');
    const prev = document.getElementById('prevBtn');
    const next = document.getElementById('nextBtn');
    if (slider && prev && next) {
      let i = 0;
      const photosCount = slider.children.length;
      const move = () => { slider.style.transform = "translateX(-" + (i * 100) + "%)"; };
      next.onclick = () => { i = (i + 1) % photosCount; move(); };
      prev.onclick = () => { i = (i - 1 + photosCount) % photosCount; move(); };
      
      // Touch support
      let ts = 0;
      slider.addEventListener('touchstart', e => ts = e.touches[0].clientX, { passive: true });
      slider.addEventListener('touchend', e => {
        const diff = ts - e.changedTouches[0].clientX;
        if (Math.abs(diff) > 50) diff > 0 ? next.onclick() : prev.onclick();
      });
    }
  </script>
</body>
</html>