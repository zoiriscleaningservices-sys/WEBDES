<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueWebX – Global Business Directory | Find Local Services Worldwide</title>
    <meta name="description" content="TrueWebX is a global business directory connecting customers with trusted local services and companies worldwide. Search for trusted businesses, view profiles, photos, and contact details. Free consultation available.">
    <meta name="keywords" content="business directory, local services, global business listings, find local companies, professional services, free consultation, business profiles">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Social -->
    <meta property="og:title" content="TrueWebX – Global Business Directory">
    <meta property="og:description" content="Discover and connect with local businesses worldwide on TrueWebX. Browse detailed profiles, photos, and contact trusted service providers.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://truewebx.site/">
    <meta property="og:image" content="https://truewebx.site/og-image.jpg">
    <meta property="og:locale" content="en_US">
    <meta name="twitter:card" content="summary_large_image">

    <link rel="canonical" href="https://truewebx.site/">

    <!-- Default Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://truewebx.site/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://truewebx.site/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://truewebx.site/favicon.png">

    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">

    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" as="style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" media="print" onload="this.media='all'">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Placeholder replaced securely by GitHub Actions -->
    <meta name="supabase-anon-key" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZycHlvbWV2amxzYWNvdXJkbWtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxNzA4ODUsImV4cCI6MjA4MTc0Njg4NX0.BsugjF75UO4TArkH5CeOIvJnMZAj8g6Ccf6hu1NsrUM">

    <style>
        :root { 
            --coral: #ff6b6b; 
            --turquoise: #0d9488; 
            --white: #ffffff;
            --light-glass: rgba(255, 255, 255, 0.22);
            --card-glass: rgba(255, 255, 255, 0.25);
            --shadow: 0 8px 32px rgba(0,0,0,0.25);
        }
        *, *::before, *::after { box-sizing: border-box; }
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overscroll-behavior: none;
        }
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: linear-gradient(135deg, var(--turquoise), var(--coral)); 
            background-attachment: fixed;
            color: var(--white); 
            min-height: 100vh; 
            overflow-x: hidden;
            transform: translateZ(0);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .wrapper {
            width: 100%;
            max-width: 100vw;
            margin: 0 auto;
            padding: 0 16px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header-wrapper {
            position: fixed;
            top: 0; left: 0; right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            transition: background 0.35s ease;
            will-change: background;
            transform: translateZ(0);
        }
        .header-wrapper.scrolled {
            background: rgba(0, 0, 0, 0.45);
        }

        /* Logo container - improved sizing logic */
        .logo {
            display: block;
            max-width: clamp(160px, 35vw, 280px);
            max-height: 64px;
            height: auto;
            line-height: 0; /* removes unwanted vertical space */
        }
        .logo img {
            width: 100%;
            height: auto;
            max-height: 64px;
            object-fit: contain;
            display: block;
            vertical-align: middle;
        }

        .login-btn {
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            text-decoration: none;
        }
        .login-btn:hover { background: rgba(255,255,255,0.4); transform: translateY(-3px); }

        /* ──────────────────────────────────────────────── */
        /* rest of your styles remain unchanged below       */
        /* ──────────────────────────────────────────────── */

        .main-content { 
            padding-top: 110px; 
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .hero { text-align: center; padding: 50px 20px 40px; width: 100%; }
        .tagline { font-size: clamp(1.8rem, 6vw, 2.8rem); font-weight: 700; margin-bottom: 16px; }
        .subtitle { font-size: clamp(1.1rem, 4vw, 1.5rem); opacity: 0.95; max-width: 900px; margin: 0 auto 50px; line-height: 1.7; }

        .search-container { 
            width: 100%; 
            max-width: 760px; 
            margin: 0 auto 40px; 
            position: relative; 
        }
        .search-box {
            width: 100%; padding: 20px 70px 20px 30px; font-size: 1.3rem;
            border-radius: 50px; border: none; background: rgba(255,255,255,0.25);
            backdrop-filter: blur(15px); color: white; box-shadow: var(--shadow);
        }
        .search-box::placeholder { color: rgba(255,255,255,0.7); }
        .search-box:focus { outline: 2px solid var(--coral); outline-offset: 4px; box-shadow: 0 0 0 5px rgba(255,107,107,0.4); }
        .search-icon { position: absolute; right: 26px; top: 50%; transform: translateY(-50%); font-size: 2rem; color: rgba(255,255,255,0.8); pointer-events: none; }

        .glass { 
            background: var(--light-glass); 
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 32px; padding: 40px 24px; margin: 20px 0; 
            border: 1px solid rgba(255,255,255,0.3); box-shadow: var(--shadow); 
            width: 100%;
            max-width: 1400px;
        }
        h2 { font-size: clamp(2rem, 6vw, 3rem); margin-bottom: 32px; text-align: center; font-weight: 700; }

        .services { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 32px; 
            width: 100%;
        }
        .card { 
            background: var(--card-glass); 
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 32px; overflow: hidden;
            box-shadow: var(--shadow); 
            transition: transform 0.4s ease; 
            display: flex; flex-direction: column;
            width: 100%;
            position: relative;
            will-change: transform;
            transform: translateZ(0);
        }
        .card:hover { transform: translateY(-10px); }

        .profile-img-wrapper { width: 100%; height: 320px; overflow: hidden; }
        .profile-img { 
            width: 100%; height: 100%; object-fit: cover; 
            transition: transform 0.5s ease;
            will-change: transform;
        }
        .card:hover .profile-img { transform: scale(1.06); }

        .card-content { 
            padding: 28px; text-align: center; 
            flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between;
        }
        .card h3 { font-size: 2rem; margin-bottom: 10px; font-weight: 700; }
        .card .location { font-size: 1.2rem; opacity: 0.9; margin-bottom: 16px; }
        .card .description-teaser { 
            line-height: 1.7; opacity: 0.95; margin-bottom: 20px; flex-grow: 1;
            overflow: hidden; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical;
        }

        .card .photos { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 14px; 
            margin: 20px 0;
        }
        .card .photos img { 
            width: 100%; height: 110px; object-fit: cover; border-radius: 16px; 
            box-shadow: 0 4px 14px rgba(0,0,0,0.3);
        }

        .private { filter: blur(6px); transition: filter 0.3s; font-weight: 600; }
        .private:hover, .private:focus { filter: none; }
        .price { font-size: 2rem !important; color: var(--coral) !important; font-weight: 800; margin: 20px 0; }

        .links { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin: 20px 0; }
        .links a { 
            color: #ffeb3b; padding: 10px 18px; background: rgba(255,255,255,0.1); 
            border-radius: 24px; font-size: 1rem; display: flex; align-items: center; gap: 8px; 
            transition: background 0.3s;
            text-decoration: none;
        }
        .links a:hover { background: rgba(255,255,255,0.25); }

        .view-btn { 
            margin: 24px auto 0; padding: 16px 36px; background: var(--coral); 
            color: white; border-radius: 50px; text-decoration: none; font-weight: bold; 
            font-size: 1.2rem; transition: all 0.3s; display: inline-block;
        }
        .view-btn:hover, .view-btn:focus { background: #ff8787; transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); outline: none; }

        .share-btn {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.4); border-radius: 50%;
            width: 50px; height: 50px; display: grid; place-items: center;
            cursor: pointer; font-size: 1.4rem; transition: all 0.3s; z-index: 2;
        }
        .share-btn:hover, .share-btn:focus { background: rgba(255,255,255,0.4); transform: scale(1.15); outline: none; }

        .no-services { font-size: 1.5rem; text-align: center; padding: 80px 20px; opacity: 0.9; }

        .profile-view-content {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            text-align: center;
            padding: 20px;
        }

        .profile-view-content > img {
            width: 100%;
            max-width: 960px;
            height: auto;
            border-radius: 32px;
            margin: 50px 0;
            box-shadow: 0 16px 50px rgba(0,0,0,0.5);
            display: block;
        }

        .contact-box {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(14px);
            border-radius: 32px;
            padding: 40px;
            margin: 50px auto;
            max-width: 700px;
            width: 100%;
        }

        .contact-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 20px 0;
            font-size: 1.6rem;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 8px 0;
            min-width: 0;
        }
        .contact-item i {
            color: var(--coral);
            font-size: 1.8rem;
            flex-shrink: 0;
        }
        .contact-item a {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            color: white;
            text-decoration: none;
        }

        .gallery-wrapper {
            position: relative;
            max-width: 960px;
            margin: 60px auto;
            overflow: hidden;
            border-radius: 32px;
            box-shadow: 0 16px 50px rgba(0,0,0,0.5);
        }
        .gallery-slider {
            display: flex;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .gallery-slider img {
            width: 100%;
            height: auto;
            max-height: 620px;
            object-fit: contain;
            background: #000;
            flex-shrink: 0;
        }

        .gallery-arrow {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 60px; height: 60px; background: rgba(0,0,0,0.5); backdrop-filter: blur(12px);
            border-radius: 50%; display: grid; place-items: center; font-size: 2.2rem;
            cursor: pointer; opacity: 0.85; transition: all 0.3s; z-index: 10;
        }
        .gallery-arrow:hover, .gallery-arrow:focus { opacity: 1; background: rgba(0,0,0,0.7); transform: translateY(-50%) scale(1.15); outline: none; }
        .gallery-arrow.prev { left: 28px; }
        .gallery-arrow.next { right: 28px; }

        footer { text-align: center; padding: 32px 20px; font-size: 0.95rem; opacity: 0.8; margin-top: auto; width: 100%; }

        @media (min-width: 768px) {
            .services { grid-template-columns: repeat(2, 1fr); }
            .profile-img-wrapper { height: 340px; }
        }
        @media (min-width: 1100px) {
            .services { grid-template-columns: repeat(3, 1fr); gap: 40px; }
            .profile-img-wrapper { height: 380px; }
        }
        @media (max-width: 768px) {
            .gallery-arrow { display: none; }
            .gallery-slider img { max-height: 500px; }
        }
    </style>
</head>
<body>
<div class="wrapper">
    <header class="header-wrapper" id="header">
        <!-- Logo now sizes naturally while respecting max bounds -->
        <a href="/" class="logo" aria-label="TrueWebX Home">
            <img src="https://truewebx.site/favicon/TrueWebX.jpeg" alt="TrueWebX Logo">
        </a>

        <a href="dashboard.html" class="login-btn" aria-label="Login or Sign Up">
            <i class="fas fa-user-circle" aria-hidden="true"></i> Login / Sign Up
        </a>
    </header>

    <main class="main-content">
        <section class="hero" aria-labelledby="hero-heading">
            <h2 id="hero-heading" class="tagline">Promote Your Business Worldwide</h2>
            <p class="subtitle">
                TrueWebX connects customers with trusted local professionals everywhere.<br>
                <strong>Free consultations • Verified services • Global reach</strong>
            </p>
        </section>

        <div class="search-container">
            <label for="searchInput" class="visually-hidden">Search businesses</label>
            <input type="text" id="searchInput" class="search-box" placeholder="Search services, businesses, or cities..." aria-label="Search businesses">
            <i class="fas fa-search search-icon" aria-hidden="true"></i>
        </div>

        <section class="glass" aria-labelledby="services-heading">
            <h2 id="services-heading">Available Services Worldwide</h2>
            <div class="services" id="list" role="list"></div>
        </section>
    </main>

    <footer role="contentinfo">© 2026 TrueWebX – The global directory for professional services</footer>
</div>

<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","name":"TrueWebX","url":"https://truewebx.site/","potentialAction":{"@type":"SearchAction","target":"https://truewebx.site/?q={search_term_string}","query-input":"required name=search_term_string"}}
</script>

<script>
    let ticking = false;
    function updateHeader() {
        const header = document.getElementById('header');
        if (window.scrollY > 50) {
            header.classList.add('scrolled');
        } else {
            header.classList.remove('scrolled');
        }
        ticking = false;
    }
    window.addEventListener('scroll', () => {
        if (!ticking) {
            requestAnimationFrame(updateHeader);
            ticking = true;
        }
    }, { passive: true });

    const supabaseUrl = 'https://vrpyomevjlsacourdmki.supabase.co';
    const anonKey = document.querySelector('meta[name="supabase-anon-key"]')?.content?.trim();

    if (!anonKey || anonKey === 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZycHlvbWV2amxzYWNvdXJkbWtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxNzA4ODUsImV4cCI6MjA4MTc0Njg4NX0.BsugjF75UO4TArkH5CeOIvJnMZAj8g6Ccf6hu1NsrUM') {
        document.getElementById('list').innerHTML = '<p class="no-services">Service temporarily unavailable – please try again later.</p>';
        console.error('Supabase anon key missing. Check deployment configuration.');
    } else {
        const supabaseClient = supabase.createClient(supabaseUrl, anonKey);
        let allServices = [];
        const BASE_PATH = '/profile';

        async function loadServices() {
            const { data: services, error } = await supabaseClient.from('services').select('*').order('created_at', { ascending: false });
            if (error || !services?.length) {
                document.getElementById('list').innerHTML = '<p class="no-services">No services published yet. Be the first to join TrueWebX!</p>';
                return;
            }
            allServices = services;
            renderServices(services);
            checkPathAndRender();
        }

        function renderServices(services) {
            const list = document.getElementById('list');
            list.innerHTML = services.length ? services.map(s => `
                <article class="card" id="service-${s.id}" itemscope itemtype="https://schema.org/LocalBusiness" role="listitem">
                    <button class="share-btn" aria-label="Copy profile link"><i class="fas fa-link" aria-hidden="true"></i></button>

                    <div class="profile-img-wrapper">
                        <img src="${s.profile || 'https://via.placeholder.com/800x600/0d9488/ffffff?text=Upload+Photo'}" 
                             alt="${s.name || 'Business'} featured image" class="profile-img" itemprop="image" loading="lazy">
                    </div>

                    <div class="card-content">
                        <div>
                            <h3 itemprop="name">${s.name || 'Professional Service'}</h3>
                            <p class="location" itemprop="address" itemscope itemtype="https://schema.org/PostalAddress">
                                <strong itemprop="addressLocality">${s.city || 'Location not specified'}</strong>
                            </p>
                            <p class="description-teaser" itemprop="description">${s.description || 'Professional service with free consultation'}</p>

                            ${s.photos?.length ? `
                            <div class="photos" aria-label="Gallery preview">
                                ${s.photos.slice(0,3).map(p => `<img src="${p}" alt="${s.name || 'Business'} gallery image" loading="lazy">`).join('')}
                                ${s.photos.length > 3 ? `<div style="grid-column:1/-1;text-align:center;font-size:1rem;opacity:0.8;margin-top:8px;" aria-hidden="true">+${s.photos.length - 3} more</div>` : ''}
                            </div>` : ''}

                            <p>Phone: <span class="private" itemprop="telephone">${s.phone || 'Contact for details'}</span></p>
                            <p>Email: <span class="private" itemprop="email">${s.gmail || 'Contact for details'}</span></p>

                            <p class="price"><strong itemprop="offers" itemscope itemtype="https://schema.org/Offer">Free Consultation</strong></p>

                            ${s.social_links?.length ? `<div class="links" aria-label="Social links">
                                ${s.social_links.map(l => `<a href="${l.url}" target="_blank" rel="noopener" itemprop="sameAs" aria-label="${l.type} profile"><i class="fab fa-${l.type.toLowerCase()}" aria-hidden="true"></i> ${l.type}</a>`).join('')}
                            </div>` : ''}
                        </div>

                        <a href="${BASE_PATH}/${s.slug}" class="view-btn" onclick="showSingleProfile('${s.slug}'); return false;" aria-label="View full profile of ${s.name}">View Full Profile →</a>
                    </div>
                </article>
            `).join('') : '<p class="no-services">No results found.</p>';

            document.querySelectorAll('.share-btn').forEach(btn => {
                btn.onclick = e => {
                    e.stopPropagation();
                    const slug = btn.closest('.card').querySelector('.view-btn').getAttribute('href').split('/').pop();
                    const url = `${location.origin}${BASE_PATH}/${slug}`;
                    navigator.clipboard.writeText(url).then(() => {
                        btn.innerHTML = '<i class="fas fa-check" aria-hidden="true"></i>';
                        setTimeout(() => btn.innerHTML = '<i class="fas fa-link" aria-hidden="true"></i>', 2000);
                    }).catch(() => alert('Copy failed – please copy URL manually'));
                };
            });
        }

        function showSingleProfile(slug) {
            const service = allServices.find(s => s.slug === slug);
            if (!service) {
                renderServices(allServices);
                history.replaceState({}, '', '/');
                return;
            }

            const fullLocation = service.city || 'Your Area';
            const pageUrl = `${location.origin}${BASE_PATH}/${slug}`;

            document.title = `#1 ${service.name} in ${fullLocation} | Free Consultation | TrueWebX`;

            const setMeta = (name, content) => {
                let el = document.querySelector(`meta[name="${name}"]`);
                if (!el) { el = document.createElement('meta'); el.name = name; document.head.appendChild(el); }
                el.content = content;
            };
            setMeta('description', `${service.name} – Professional service in ${fullLocation}. ${service.description?.slice(0,150) || 'Free consultation available.'} Contact today.`);

            let canonical = document.querySelector('link[rel="canonical"]');
            if (!canonical) { canonical = document.createElement('link'); canonical.rel = 'canonical'; document.head.appendChild(canonical); }
            canonical.href = pageUrl;

            const setOG = (prop, content) => {
                let el = document.querySelector(`meta[property="og:${prop}"]`);
                if (!el) { el = document.createElement('meta'); el.setAttribute('property', `og:${prop}`); document.head.appendChild(el); }
                el.content = content;
            };
            setOG('title', `${service.name} – #1 in ${fullLocation} | TrueWebX`);
            setOG('description', document.querySelector('meta[name="description"]').content);
            setOG('url', pageUrl);
            setOG('image', service.profile || 'https://truewebx.site/og-image.jpg');

            ['title', 'description', 'image'].forEach(p => {
                let el = document.querySelector(`meta[name="twitter:${p}"]`);
                if (!el) { el = document.createElement('meta'); el.name = `twitter:${p}`; document.head.appendChild(el); }
                el.content = p === 'image' ? (service.profile || 'https://truewebx.site/og-image.jpg') : (p === 'title' ? document.title : document.querySelector('meta[name="description"]').content);
            });

            if (service.profile) {
                ['180x180|apple-touch-icon', '32x32|icon', '16x16|icon'].forEach(spec => {
                    const [size, rel] = spec.split('|');
                    let link = document.querySelector(`link[rel="${rel}"]${size ? `[sizes="${size}x${size}"]` : ''}`);
                    if (!link) { link = document.createElement('link'); link.rel = rel; if (size) link.sizes = `${size}x${size}`; document.head.appendChild(link); }
                    link.href = service.profile;
                });
            }

            const lb = {
                "@context": "https://schema.org",
                "@type": "LocalBusiness",
                "name": service.name,
                "image": service.profile || "",
                "url": pageUrl,
                "telephone": service.phone || "",
                "email": service.gmail || "",
                "address": {"@type":"PostalAddress","addressLocality":fullLocation},
                "description": service.description || "Professional service with free consultation",
                "priceRange": "$",
                "openingHours": "Mo-Su 08:00-20:00",
                "sameAs": service.social_links?.map(l => l.url) || []
            };
            let script = document.getElementById('lbSchema');
            if (!script) { script = document.createElement('script'); script.id = 'lbSchema'; script.type = 'application/ld+json'; document.head.appendChild(script); }
            script.textContent = JSON.stringify(lb);

            const galleryHTML = service.photos?.length ? `
                <div class="gallery-wrapper" id="galleryWrapper" aria-label="Business gallery">
                    <div class="gallery-slider" id="gallerySlider">
                        ${service.photos.map(p => `<img src="${p}" alt="${service.name} gallery image" loading="lazy">`).join('')}
                    </div>
                    <button class="gallery-arrow prev" id="prevBtn" aria-label="Previous image"><i class="fas fa-chevron-left" aria-hidden="true"></i></button>
                    <button class="gallery-arrow next" id="nextBtn" aria-label="Next image"><i class="fas fa-chevron-right" aria-hidden="true"></i></button>
                </div>` : '<p style="opacity:0.8;">No gallery photos yet.</p>';

            document.querySelector('.glass').innerHTML = `
                <section class="profile-view-content" aria-labelledby="profile-title">
                    ${service.profile ? `<img src="${service.profile}" alt="${service.name} profile" loading="lazy">` : ''}

                    <p style="font-size:1.5rem;line-height:1.9;max-width:860px;margin:40px auto;opacity:0.95;">
                        ${service.description || 'Professional, reliable, and trusted service tailored to your needs.'}
                    </p>

                    <div class="contact-box" aria-label="Contact information">
                        ${service.phone ? `<div class="contact-item"><i class="fas fa-phone" aria-hidden="true"></i><div><a href="tel:${service.phone.replace(/[^0-9+]/g,'')}">${service.phone}</a></div></div>` : ''}
                        ${service.gmail ? `<div class="contact-item"><i class="fas fa-envelope" aria-hidden="true"></i><div><a href="mailto:${service.gmail}">Send Email</a></div></div>` : ''}
                    </div>

                    <p style="font-size:2.8rem;color:var(--coral);font-weight:800;margin:60px 0;">Free Consultation Available</p>

                    <h2 style="font-size:2.8rem;margin:70px 0 50px;">Gallery</h2>
                    ${galleryHTML}

                    <a href="/" class="view-btn" style="display:inline-block;padding:18px 50px;font-size:1.5rem;" onclick="renderServices(allServices); history.replaceState({}, '', '/'); return false;" aria-label="Back to directory">
                        ← Back to Directory
                    </a>
                </section>`;

            if (service.photos?.length > 1) {
                const slider = document.getElementById('gallerySlider');
                const prev = document.getElementById('prevBtn');
                const next = document.getElementById('nextBtn');
                let i = 0;
                const move = () => slider.style.transform = `translateX(-${i * 100}%)`;
                next.onclick = () => { i = (i + 1) % service.photos.length; move(); };
                prev.onclick = () => { i = (i - 1 + service.photos.length) % service.photos.length; move(); };
                let ts = 0;
                slider.parentElement.addEventListener('touchstart', e => ts = e.touches[0].clientX, {passive:true});
                slider.parentElement.addEventListener('touchend', e => {
                    const diff = ts - e.changedTouches[0].clientX;
                    if (Math.abs(diff) > 50) diff > 0 ? next.onclick() : prev.onclick();
                });
            }

            history.replaceState({slug: slug}, '', `${BASE_PATH}/${slug}`);
            window.scrollTo(0,0);
        }

        function getCurrentSlug() {
            const path = window.location.pathname;
            if (!path.startsWith(BASE_PATH + '/')) return null;
            return path.slice(BASE_PATH.length + 1).replace(/\/$/, '') || null;
        }

        function checkPathAndRender() {
            const slug = getCurrentSlug();
            if (slug) {
                showSingleProfile(slug);
            } else {
                renderServices(allServices);
            }
        }

        document.getElementById('searchInput').addEventListener('input', e => {
            const q = e.target.value.toLowerCase().trim();
            const filtered = q ? allServices.filter(s => [s.name, s.city, s.description].some(t => t?.toLowerCase().includes(q))) : allServices;
            renderServices(filtered);
        });

        window.addEventListener('popstate', checkPathAndRender);

        document.addEventListener('DOMContentLoaded', () => {
            const slug = getCurrentSlug();
            if (slug) {
                history.replaceState({slug: slug}, '', location.pathname);
            }
            loadServices();
        });
    }
</script>
</body>
</html>
